[tools]
rust = "1.90.0"

[tasks.fmt]
description = "Format the entire workspace with rustfmt"
run = "cargo fmt --all"

[tasks.lint]
description = "Run clippy across the workspace"
run = "cargo clippy --workspace --all-targets -- -D warnings -D clippy::pedantic"

[tasks.test]
description = "Execute workspace tests"
run = "cargo test --workspace --all-targets"

[tasks.coverage]
description = "Generate code coverage summary (text)"
run = """
echo "Running coverage analysis..."
cargo llvm-cov --workspace --all-targets --fail-under-lines 80 2>&1 | grep -A 50 "^Filename" | tail -20 || {
    EXIT_CODE=$?
    echo "❌ Coverage check failed (threshold: 80%)"
    exit $EXIT_CODE
}
echo "✅ Coverage check passed (≥80%)"
cargo llvm-cov --workspace --all-targets --fail-under-lines 80
"""

[tasks.coverage-open]
description = "Generate and open code coverage report in browser"
run = "cargo llvm-cov --workspace --all-targets --open --fail-under-lines 80"

[tasks.check]
description = "Run formatting, linting, tests, security, and coverage"
depends = ["fmt", "lint", "test", "security", "coverage"]

[tasks.security]
description = "Run security audit and license checks"
run = """
cargo audit
cargo deny check
"""
